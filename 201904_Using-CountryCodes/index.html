<!doctype html>
<html lang="en-US"><head>
   <meta charset="utf-8">
    <!-- Chulapa Jekyll Theme - master dev -->
    <!--  MIT License-->
    <!-- Docs: https://dieghernan.github.io/chulapa -->
    <!-- Repo: https://github.com/dieghernan/chulapa -->
    <!-- Page build 2022-02-16 20:09:40 +0100 -->
    <!--Google Structured Data-->
    <script type="application/ld+json">
        {
      "@context": "https://schema.org",
      "@type": "BlogPosting",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://dieghernan.github.io/201904_Using-CountryCodes/"
      },
      "headline": "Using CountryCodes database and sf package",
      "image": "https://dieghernan.github.io/assets/img/blog/20190427_mapfin-1.png",
      "datePublished": "2019-04-27T00:00:00+02:00",
      "dateModified": "2019-04-27T00:00:00+02:00",
      "author": {
        "@type": "Person",
        "name": "dieghernan"
      },
       "publisher": {
        "@type": "Organization",
        "name": "dieghernan",
        "logo": {
          "@type": "ImageObject",
          "url": "https://dieghernan.github.io/assets/img/site/banner.png"
        }
      }
    }
    </script>
        <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Blog",
        "item": "https://dieghernan.github.io/blog/"
      },
    {
        "@type": "ListItem",
        "position": 2,
        "name": "Using CountryCodes database and sf package"
      }]
    }
    </script>
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "name": "Using CountryCodes database and sf package",
    "description": "vignette of the CountryCodes project - This vignette is an example of use of the database provided in the Github project Country Codes and International Organizations &amp; Groups
  by using the sf package in R.
"
    }
}
</script><script type="application/ld+json">
{
  "@context" : "https://schema.org",
  "@type" : "Person",
  "image": "https://dieghernan.github.io/assets/img/site/avatar.png",
  "homeLocation": {
    "@type": "Place",
    "name": "Madrid, Spain"
    },
  "description": "Publisher",
  "name" : "dieghernan",
  "url" : "https://dieghernan.github.io/"
  ,  "sameAs" : [
  "https://github.com/dieghernan/"
  ]
}
</script>
   <title>Using CountryCodes database and sf package | One world</title>
  <link rel="canonical" href="https://dieghernan.github.io/201904_Using-CountryCodes/">
    <!-- Atom feed -->
  <link href="https://dieghernan.github.io/atom.xml" type="application/atom+xml" rel="alternate" title="Atom feed One world" />
    <!-- RSS 2.0 feed -->
  <link href="https://dieghernan.github.io/rss.xml" type="application/rss+xml" rel="alternate" title="RSS 2.0 feed One world" />
    <!-- Meta tags -->
   <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
   <meta name="author" content="dieghernan" />
   <meta name="copyright" content="dieghernan" />
   <meta name="description" content="vignette of the CountryCodes project - This vignette is an example of use of the database provided in the Github project Country Codes and International Orga..."/>
   <meta name="thumbnail" content="https://dieghernan.github.io/assets/img/blog/20190427_mapfin-1.png" />
   <meta name="robots" content="index, follow"><meta name="keywords" content="blog,chulapa,maps,r-language"/>
    <!-- OpenGraph -->
   <meta property="og:title" content="Using CountryCodes database and sf package | One world" />
   <meta property="og:site_name" content="One world | Projects, maps and coding" />
   <meta property="og:url" content="https://dieghernan.github.io/201904_Using-CountryCodes/" />
   <meta property="og:type" content="website" />
   <meta property="og:description" content="vignette of the CountryCodes project - This vignette is an example of use of the database provided in the Github..." />
   <meta property="og:locale" content="en-US" />
   <meta property="og:image" content="https://dieghernan.github.io/assets/img/blog/20190427_mapfin-1.png" />
    <!-- Twitter Cards -->
   <meta name="twitter:card" content="summary_large_image">
   <meta name="twitter:site" content="@dhernangomez" />
    	<!-- CSS -->
    <!-- Preconnect with Google Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">
    <!-- Fontawesome-->
    <!-- v5.13 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">
    <!-- Theme css (Bootstrap included) -->
  <link rel="stylesheet" href="https://dieghernan.github.io/assets/css/main.css" />
    <!-- Highlighter -->
  <link id="csshigh" rel="stylesheet" href="https://dieghernan.github.io/assets/css/highlighter.css" />
    <!-- Custom css -->
  <link rel="stylesheet" href="https://dieghernan.github.io/assets/css/custom.css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-FWXW2HLTVZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-FWXW2HLTVZ');
</script>
<!-- start custom head snippets -->
<!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="mask-icon" href="/assets/img/favicons/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="msapplication-TileColor" content="#2b5797">
<meta name="msapplication-TileImage" content="/assets/img/favicons/mstile-144x144.png">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#000000">
<!-- end custom head snippets --></head>
<body class="d-flex flex-column">
	<div class="navbar-chulapa-fab d-xl-none">
		<input type="checkbox" class="navbar-chulapa-fab-button d-none" id="navi-toggle">
		<label for="navi-toggle" class="navbar-toggler p-1 m-0 text-center d-flex">
			<span class="navbar-toggler-icon m-auto">&nbsp;</span>
		</label>
		<div class="navbar-chulapa-fab-background">&nbsp;</div>
		<nav class="navbar-chulapa-fab-nav">
			<ul class="navbar-nav text-center text-uppercase font-weight-light mt-0 mb-1 py-1">
				<li class="nav-item">
					<a class="nav-link px-3 navbar-brand mx-1 " href="https://dieghernan.github.io/"><img src="https://dieghernan.github.io/assets/img/favicons/android-chrome-72x72.png" width="30" height="30" class="d-inline-block align-top rounded-lg text-center mr-1" alt="NavbarLogo">Home</a>
				</li><li class="nav-item my-0 py-1">
					<a class="nav-link px-3 py-1" href="https://dieghernan.github.io/blog/">Blog</a>
				</li><li class="nav-item my-0 py-1">
					<a class="nav-link px-3 py-1" href="https://dieghernan.github.io/projects">Projects</a>
				</li><li class="nav-item dropdown my-0 py-1"><a class="nav-link dropdown-toggle px-3 py-1 " href="#" id="Archives" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Archives</a>
					<div class="dropdown-menu dropdown-menu-right text-center rounded-0 pr-4" aria-labelledby="Archives"><a class="dropdown-item nav-link d-block px-3 small " href="https://dieghernan.github.io/archive">By date </a><a class="dropdown-item nav-link d-block px-3 small " href="https://dieghernan.github.io/tags">By tags </a></div>
				</li><li class="nav-item my-0 py-1">
					<a class="nav-link px-3 py-1" href="https://dieghernan.github.io/gallery">Gallery</a>
				</li><li class="nav-item my-0 py-1">
					<a class="nav-link px-3 py-1" href="https://github.com/dieghernan/dieghernan.github.io"><i class="fab fa-github" aria-hidden="true"></i> Github repo</a>
				</li><li class="nav-item my-0 py-1">
					<a class="nav-link px-3 py-1 " href="https://dieghernan.github.io/search">Search</a>
				</li></ul>
		</nav>
	</div>
	<nav class="navbar navbar-expand sticky-top navbar-chulapa d-none d-xl-block ">
	<div class="container-fluid mx-md-2">
			<a class="navbar-brand text-uppercase font-weight-light" href="https://dieghernan.github.io/"><img src="https://dieghernan.github.io/assets/img/favicons/android-chrome-72x72.png" width="30" height="30" class="d-inline-block align-top rounded-lg mr-1" alt="NavbarLogo">Home</a><ul class="navbar-nav ml-auto"><li class="nav-item mx-2">
						<a class="nav-link text-uppercase font-weight-light " href="https://dieghernan.github.io/blog/">Blog</a>
					</li><li class="nav-item mx-2">
						<a class="nav-link text-uppercase font-weight-light " href="https://dieghernan.github.io/projects">Projects</a>
					</li><li class="nav-item mx-2 dropdown"><a class="nav-link text-uppercase font-weight-light dropdown-toggle " href="#" id="Archives2" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Archives</a>
						<div class="dropdown-menu dropdown-menu-right" aria-labelledby="Archives2"><a class="dropdown-item text-uppercase font-weight-light " href="https://dieghernan.github.io/archive">By date</a><a class="dropdown-item text-uppercase font-weight-light " href="https://dieghernan.github.io/tags">By tags</a></div>
					</li><li class="nav-item mx-2">
						<a class="nav-link text-uppercase font-weight-light " href="https://dieghernan.github.io/gallery">Gallery</a>
					</li><li class="nav-item mx-2">
						<a class="nav-link text-uppercase font-weight-light " href="https://github.com/dieghernan/dieghernan.github.io"><i class="fab fa-github" aria-hidden="true"></i> Github repo</a>
					</li><li class="nav-item mx-2">
						<a class="nav-link text-uppercase font-weight-light " href="https://dieghernan.github.io/search">
							<i class="fa fa-search" aria-hidden="true"></i><span class="sr-only">Search</span>
						</a>
					</li></ul></div>
</nav>	<header class="header-chulapa"><div class="container-fluid header-chulapa-img w-100" style="background-image: url('https://dieghernan.github.io/assets/img/blog/20190427_mapfin-1.png')">
     </div><div class="container-lg mt-2">
       <div class="row">
           <div class="col-lg-8 offset-lg-2">
           <h1>Using CountryCodes database and sf package</h1><p class="lead chulapa-subtitle">vignette of the CountryCodes project</p>
           <hr class="mb-0">
			</div>
		</div>
	</div>
</header>
	<main class="container-lg pb-3 flex-fill">
<div class="row my-1">
<div class="col-lg-6 offset-lg-2 col small">
 <nav aria-label="breadcrumb">
  <ol class="breadcrumb my-0 py-0 chulapa-bg-transparent pl-0" itemscope itemtype="https://schema.org/BreadcrumbList">
            <li class="breadcrumb-item" itemprop="itemListElement" itemscope
          itemtype="https://schema.org/ListItem"><a href="https://dieghernan.github.io/blog/" itemprop="item"><span itemprop="name">Blog</span></a>
         <meta itemprop="position" content="1" /></li>
      <li class="breadcrumb-item active" aria-current="page" itemprop="itemListElement" itemscope
          itemtype="https://schema.org/ListItem">
        <span itemprop="name">Using CountryCodes database and sf package</span>
       <meta itemprop="position" content="2" />
     </li>
 </ol>
 </nav>
 <div class="chulapaDateSocial">
            <time datetime="2019-04-27T00:00:00+02:00">27 apr 2019</time>
        </div></div><div class="col-lg-2 col-3 text-right lead chulapaDateSocial">
            <a  href="https://twitter.com/intent/tweet?url=https://dieghernan.github.io/201904_Using-CountryCodes/&text=Using+CountryCodes+database+and+sf+package&via=dhernangomez&hashtags=rstats,rspatial,sf,maps,vignette" title="Share on Twitter"><i class="fab fa-twitter-square fa-lg" aria-hidden="true"></i></a>
            <a  class="d-none d-sm-inline" href="https://www.facebook.com/sharer.php?u=https://dieghernan.github.io/201904_Using-CountryCodes/" title="Share on Facebook"><i class="fab fa-facebook-square fa-lg" aria-hidden="true"></i></a>
             <a  href="https://api.whatsapp.com/send?&text=Using+CountryCodes+database+and+sf+package%20https://dieghernan.github.io/201904_Using-CountryCodes/" title="Share on Whatsapp"><i class="fab fa-whatsapp-square fa-lg" aria-hidden="true"></i></a>
         <a  class="d-none d-sm-inline" href="https://www.linkedin.com/shareArticle?url=https://dieghernan.github.io/201904_Using-CountryCodes/&title=Using+CountryCodes+database+and+sf+package" title="Share on LinkedIn"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
         </div></div>
		<div class="row pt-2">
			<aside class="col-lg-2 mt-lg-3 small"><div class="row d-flex align-items-center mb-2"><img src="https://dieghernan.github.io/assets/img/site/avatar.png" alt="dieghernan" class="ml-3 mr-0 mx-lg-auto mb-lg-1 chulapa-avatar-size"><div class="col-9 col-lg-12 text-lg-center">
						dieghernan
					</div>
				</div>
				<div class="row mb-2 mb-lg-0">
					<div class="col text-lg-center"><address class="d-inline d-lg-block mr-2 mx-lg-auto mb-lg-2 small chulapa-links-hover-only">
						  <a class="pr-lg-0" href="https://www.google.com/maps/search/?api=1&query=Madrid%2C+Spain">
						    <i class="fas fa-map-marker-alt fa-lg mr-1" aria-hidden="true"></i>Madrid, Spain</a>
						</address><div class="d-inline my-1 mx-lg-0 chulapa-links-hover-only"><a class="mr-2 mx-lg-1" href="https://github.com/dieghernan/"><i class="fab fa-github fa-lg"></i></a></div></div>
				</div>
</aside>
			<article class="col-lg-8 mt-3">
			<p>This vignette is an example of use of the database provided in the Github project <a href="https://dieghernan.github.io/projects/countrycodes/">Country Codes and International Organizations &amp; Groups</a>
  by using the <code class="language-plaintext highlighter-rouge">sf</code> package in R.</p>
<h2 id="required-r-packages">Required R packages</h2>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">sf</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">jsonlite</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">rnaturalearth</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<h2 id="reading-the-data">Reading the data</h2>
<p>The first step consists on reading the database provided (in this example the <code class="language-plaintext highlighter-rouge">json</code> file) and extracting one international organization. In this example we will plot the <a href="https://en.wikipedia.org/wiki/Commonwealth_of_Nations">Commonwealth of Nations</a>.</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fromJSON</span><span class="p">(</span><span class="s2">"https://raw.githubusercontent.com/dieghernan/Country-Codes-and-International-Organizations/master/outputs/Countrycodesfull.json"</span><span class="p">)</span><span class="w">
</span><span class="c1"># Identify Commonwealth acronym</span><span class="w">
</span><span class="n">orgsdb</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"https://raw.githubusercontent.com/dieghernan/Country-Codes-and-International-Organizations/master/outputs/CountrycodesOrgs.csv"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">distinct</span><span class="p">(</span><span class="n">org_id</span><span class="p">,</span><span class="w"> </span><span class="n">org_name</span><span class="p">)</span><span class="w">

</span><span class="n">kable</span><span class="p">(</span><span class="n">orgsdb</span><span class="p">[</span><span class="n">grep</span><span class="p">(</span><span class="s2">"Common"</span><span class="p">,</span><span class="w"> </span><span class="n">orgsdb</span><span class="o">$</span><span class="n">org_name</span><span class="p">),</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"markdown"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<table>
<thead>
   <tr>
     <th style="text-align: left"> </th>
     <th style="text-align: left">org_name</th>
     <th style="text-align: left">org_id</th>
   </tr>
 </thead>
 <tbody>
   <tr>
     <td style="text-align: left">25</td>
     <td style="text-align: left">Commonwealth</td>
     <td style="text-align: left">C</td>
   </tr>
   <tr>
     <td style="text-align: left">26</td>
     <td style="text-align: left">Central American Common Market</td>
     <td style="text-align: left">CACM</td>
   </tr>
   <tr>
     <td style="text-align: left">30</td>
     <td style="text-align: left">Caribbean Community and Common Market</td>
     <td style="text-align: left">CARICOM</td>
   </tr>
   <tr>
     <td style="text-align: left">42</td>
     <td style="text-align: left">Commonwealth of Independent States</td>
     <td style="text-align: left">CIS</td>
   </tr>
   <tr>
     <td style="text-align: left">43</td>
     <td style="text-align: left">Common Market for Eastern and Southern Africa</td>
     <td style="text-align: left">COMESA</td>
   </tr>
   <tr>
     <td style="text-align: left">115</td>
     <td style="text-align: left">Southern Cone Common Market</td>
     <td style="text-align: left">MERCOSUR</td>
   </tr>
 </tbody>
</table>
<p>In our case, the value to search is <strong>C</strong>. It is provided also a function that extract the membership from the <code class="language-plaintext highlighter-rouge">json</code> database:</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ISO_memcol</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w">
                       </span><span class="n">orgtosearch</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">ind</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">match</span><span class="p">(</span><span class="n">orgtosearch</span><span class="p">,</span><span class="w"> </span><span class="n">unlist</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="s2">"org_id"</span><span class="p">]))</span><span class="w">
  </span><span class="n">or</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lapply</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">nrow</span><span class="p">(</span><span class="n">df</span><span class="p">),</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">unlist</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="s2">"org_member"</span><span class="p">])[</span><span class="n">ind</span><span class="p">]</span><span class="w">
  </span><span class="p">})</span><span class="w">
  </span><span class="n">or</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">matrix</span><span class="p">(</span><span class="n">unlist</span><span class="p">(</span><span class="n">or</span><span class="p">)),</span><span class="w"> </span><span class="n">stringsAsFactors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">)</span><span class="w">
  </span><span class="nf">names</span><span class="p">(</span><span class="n">or</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">orgtosearch</span><span class="w">
  </span><span class="n">df2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">cbind</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">or</span><span class="p">,</span><span class="w"> </span><span class="n">stringsAsFactors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">))</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">df_org</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ISO_memcol</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="s2">"C"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p>Now <code class="language-plaintext highlighter-rouge">df_org</code> has a new column, named <strong>C</strong>, containing the membership status of each country.</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_org</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">count</span><span class="p">(</span><span class="n">C</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">kable</span><span class="p">(</span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"markdown"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<table>
<thead>
   <tr>
     <th style="text-align: left">C</th>
     <th style="text-align: right">n</th>
   </tr>
 </thead>
 <tbody>
   <tr>
     <td style="text-align: left">member</td>
     <td style="text-align: right">53</td>
   </tr>
   <tr>
     <td style="text-align: left">NA</td>
     <td style="text-align: right">222</td>
   </tr>
 </tbody>
</table>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_org</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">C</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="w">
    </span><span class="n">ISO_3166_3</span><span class="p">,</span><span class="w">
    </span><span class="n">NAME.EN</span><span class="p">,</span><span class="w">
    </span><span class="n">C</span><span class="w">
  </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">head</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">kable</span><span class="p">(</span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"markdown"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<table>
<thead>
   <tr>
     <th style="text-align: left">ISO_3166_3</th>
     <th style="text-align: left">NAME.EN</th>
     <th style="text-align: left">C</th>
   </tr>
 </thead>
 <tbody>
   <tr>
     <td style="text-align: left">ATG</td>
     <td style="text-align: left">Antigua &amp; Barbuda</td>
     <td style="text-align: left">member</td>
   </tr>
   <tr>
     <td style="text-align: left">AUS</td>
     <td style="text-align: left">Australia</td>
     <td style="text-align: left">member</td>
   </tr>
   <tr>
     <td style="text-align: left">BHS</td>
     <td style="text-align: left">Bahamas</td>
     <td style="text-align: left">member</td>
   </tr>
   <tr>
     <td style="text-align: left">BGD</td>
     <td style="text-align: left">Bangladesh</td>
     <td style="text-align: left">member</td>
   </tr>
   <tr>
     <td style="text-align: left">BRB</td>
     <td style="text-align: left">Barbados</td>
     <td style="text-align: left">member</td>
   </tr>
   <tr>
     <td style="text-align: left">BLZ</td>
     <td style="text-align: left">Belize</td>
     <td style="text-align: left">member</td>
   </tr>
 </tbody>
</table>
<h2 id="replacing-the-data-on-a-map">Replacing the data on a map.</h2>
<p>In this example the <code class="language-plaintext highlighter-rouge">rnaturalearth</code> package is used for retrieving an <code class="language-plaintext highlighter-rouge">sf</code> object.  The code below replaces the <code class="language-plaintext highlighter-rouge">data.frame</code> part of the <code class="language-plaintext highlighter-rouge">sf</code>object.
and replacing the <code class="language-plaintext highlighter-rouge">dataframe</code>for the dedicated database.</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">testmap</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ne_countries</span><span class="p">(</span><span class="m">50</span><span class="p">,</span><span class="w">
  </span><span class="s2">"countries"</span><span class="p">,</span><span class="w">
  </span><span class="n">returnclass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"sf"</span><span class="w">
</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="n">ISO_3166_3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">adm0_a3</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">full_join</span><span class="p">(</span><span class="n">df_org</span><span class="p">)</span><span class="w">

</span><span class="c1"># We add also tiny countries</span><span class="w">
</span><span class="n">tiny</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ne_countries</span><span class="p">(</span><span class="m">50</span><span class="p">,</span><span class="w">
  </span><span class="s2">"tiny_countries"</span><span class="p">,</span><span class="w">
  </span><span class="n">returnclass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"sf"</span><span class="w">
</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="n">ISO_3166_3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">adm0_a3</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">full_join</span><span class="p">(</span><span class="n">df_org</span><span class="p">)</span><span class="w">

</span><span class="c1"># Identify dependencies</span><span class="w">
</span><span class="n">ISOCommon</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df_org</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">C</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="w">
    </span><span class="n">ISO_3166_3.sov</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ISO_3166_3</span><span class="p">,</span><span class="w">
    </span><span class="n">C_sov</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">C</span><span class="w">
  </span><span class="p">)</span><span class="w">
</span><span class="n">tiny</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">left_join</span><span class="p">(</span><span class="n">tiny</span><span class="p">,</span><span class="w"> </span><span class="n">ISOCommon</span><span class="p">)</span><span class="w">
</span><span class="n">tiny</span><span class="o">$</span><span class="n">C</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">coalesce</span><span class="p">(</span><span class="n">tiny</span><span class="o">$</span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">tiny</span><span class="o">$</span><span class="n">C_sov</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<h2 id="plotting-map-wikipedia-style">Plotting map: Wikipedia style</h2>
<p>Now we would try to plot a map resembling the one presented in the <a href="https://en.wikipedia.org/wiki/Commonwealth_of_Nations">Wikipedia page</a> for the Commonwealth.</p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/e/e2/Member_states_of_the_Commonwealth_of_Nations.svg" alt="Wiki" /></p>
<p>The map we will generate is presented under a Robinson projection and the color palette will be based in the <a href="https://en.wikipedia.org/wiki/Wikipedia:WikiProject_Maps/Conventions/Orthographic_maps">Wikipedia convention for Orthographic Maps</a>, since it is the one used in the example.</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Projecting the map</span><span class="w">
</span><span class="n">testmap_rob</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_transform</span><span class="p">(</span><span class="n">testmap</span><span class="p">,</span><span class="w"> </span><span class="s2">"+proj=robin"</span><span class="p">)</span><span class="w">
</span><span class="n">tiny_rob</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_transform</span><span class="p">(</span><span class="n">tiny</span><span class="p">,</span><span class="w"> </span><span class="s2">"+proj=robin"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Bounding box</span><span class="w">
</span><span class="n">bbox</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_linestring</span><span class="p">(</span><span class="n">rbind</span><span class="p">(</span><span class="w">
  </span><span class="nf">c</span><span class="p">(</span><span class="m">-180</span><span class="p">,</span><span class="w"> </span><span class="m">90</span><span class="p">),</span><span class="w">
  </span><span class="nf">c</span><span class="p">(</span><span class="m">180</span><span class="p">,</span><span class="w"> </span><span class="m">90</span><span class="p">),</span><span class="w">
  </span><span class="nf">c</span><span class="p">(</span><span class="m">180</span><span class="p">,</span><span class="w"> </span><span class="m">-90</span><span class="p">),</span><span class="w">
  </span><span class="nf">c</span><span class="p">(</span><span class="m">-180</span><span class="p">,</span><span class="w"> </span><span class="m">-90</span><span class="p">),</span><span class="w">
  </span><span class="nf">c</span><span class="p">(</span><span class="m">-180</span><span class="p">,</span><span class="w"> </span><span class="m">90</span><span class="p">)</span><span class="w">
</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">st_segmentize</span><span class="p">(</span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">st_cast</span><span class="p">(</span><span class="s2">"POLYGON"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">st_sfc</span><span class="p">(</span><span class="n">crs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4326</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">st_transform</span><span class="p">(</span><span class="n">crs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"+proj=robin"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Plotting</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">bg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span><span class="w">
  </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#FFFFFF"</span><span class="p">,</span><span class="w">
  </span><span class="n">border</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#AAAAAA"</span><span class="p">,</span><span class="w">
  </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span><span class="w">
</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="w">
  </span><span class="n">st_geometry</span><span class="p">(</span><span class="n">testmap_rob</span><span class="p">),</span><span class="w">
  </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#B9B9B9"</span><span class="p">,</span><span class="w">
  </span><span class="n">border</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#FFFFFF"</span><span class="p">,</span><span class="w">
  </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w">
  </span><span class="n">add</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="n">plot</span><span class="p">(</span><span class="w">
  </span><span class="n">st_geometry</span><span class="p">(</span><span class="n">testmap_rob</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">C</span><span class="p">))),</span><span class="w">
  </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#346733"</span><span class="p">,</span><span class="w">
  </span><span class="n">border</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#FFFFFF"</span><span class="p">,</span><span class="w">
  </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w">
  </span><span class="n">add</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="c1"># By last, add tiny countries</span><span class="w">
</span><span class="c1"># All</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="w">
  </span><span class="n">st_geometry</span><span class="p">(</span><span class="n">tiny_rob</span><span class="p">),</span><span class="w">
  </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#000000"</span><span class="p">,</span><span class="w">
  </span><span class="n">bg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#B9B9B9"</span><span class="p">,</span><span class="w">
  </span><span class="n">add</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">,</span><span class="w">
  </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">21</span><span class="w">
</span><span class="p">)</span><span class="w">
</span><span class="c1"># Dependencies</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="w">
  </span><span class="n">st_geometry</span><span class="p">(</span><span class="n">tiny_rob</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">C</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">ISO_3166_3.sov</span><span class="p">))),</span><span class="w">
  </span><span class="n">bg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#C6DEBD"</span><span class="p">,</span><span class="w">
  </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#000000"</span><span class="p">,</span><span class="w">
  </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">21</span><span class="p">,</span><span class="w">
  </span><span class="n">add</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="w">
</span><span class="p">)</span><span class="w">
</span><span class="c1"># Independent</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="w">
  </span><span class="n">st_geometry</span><span class="p">(</span><span class="n">tiny_rob</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">C</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">ISO_3166_3.sov</span><span class="p">))),</span><span class="w">
  </span><span class="n">bg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#346733"</span><span class="p">,</span><span class="w">
  </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#000000"</span><span class="p">,</span><span class="w">
  </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">21</span><span class="p">,</span><span class="w">
  </span><span class="n">add</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="w">
</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span><span class="w">
  </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w">
  </span><span class="n">border</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#AAAAAA"</span><span class="p">,</span><span class="w">
  </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span><span class="p">,</span><span class="w">
  </span><span class="n">add</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="w">
</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p><img src="../assets/img/blog/20190427_mapfin-1.png" alt="plot of chunk 20190427_mapfin" /></p>
</article>
		</div>
	</main><nav aria-label="Navigation" class="container-lg chulapa-pagination  ">
 <ul class="col-lg-8 offset-lg-2 pagination chulapa-pagination-round px-0 ">
   <li class="page-item text-left mr-auto invisible">
      <a class="page-link border-0 px-4" href="" tabindex="-1">
	  <i class="fa fa-chevron-left" aria-hidden="true"></i><span class="sr-only">Previous</span>
	  </a>
   </li>
   <li class="page-item text-right ml-auto ">
      <a class="page-link border-0 px-4" href="https://dieghernan.github.io/201905_Cast-to-subsegments/">
	  <i class="fa fa-chevron-right" aria-hidden="true"></i><span class="sr-only">Next</span></a>
   </li>
 </ul>
</nav>
<div class="container-lg my-1">
 <div class="row">
   <div class="col-lg-8 offset-lg-2 col">
      <i class="fas fa-tag mr-1 fa-xs" aria-hidden="true"></i>
      <a href="https://dieghernan.github.io/tags#rstats" class="badge chulapa-pill-bg-primary">rstats</a>
      <a href="https://dieghernan.github.io/tags#rspatial" class="badge chulapa-pill-bg-primary">rspatial</a>
      <a href="https://dieghernan.github.io/tags#sf" class="badge chulapa-pill-bg-primary">sf</a>
      <a href="https://dieghernan.github.io/tags#maps" class="badge chulapa-pill-bg-primary">maps</a>
      <a href="https://dieghernan.github.io/tags#vignette" class="badge chulapa-pill-bg-primary">vignette</a>
     </div>
   </div>
</div>
<!-- Footer -->
 <footer class="footer-chulapa text-center mt-0 pt-3">
   <div class="container">
     <div class="row">
       <div class="col-xl-10 offset-xl-1"><div role="navigation" class="d-flex flex-wrap justify-content-center"><a href="https://dieghernan.github.io/atom.xml" title="footerRSS" class="chulapa-footer-sociallink lead"><span class="fa-stack fa-lg" aria-hidden="true">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
              </span><span class="sr-only">RSS</span>
            </a><a href="https://stackoverflow.com/users/7877917/dieghernan" title="footerStack Overflow" class="chulapa-footer-sociallink lead"><span class="fa-stack fa-lg" aria-hidden="true">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fab fa-stack-overflow fa-stack-1x fa-inverse"></i>
              </span><span class="sr-only">Stack Overflow</span>
            </a><a href="https://commons.wikimedia.org/wiki/Special:ListFiles?limit=50&user=dieghernan84" title="footerWikiCommons" class="chulapa-footer-sociallink lead"><span class="fa-stack fa-lg" aria-hidden="true">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fab fa-wikipedia-w fa-stack-1x fa-inverse"></i>
              </span><span class="sr-only">WikiCommons</span>
            </a><a href="https://github.com/dieghernan/" title="footerGithub" class="chulapa-footer-sociallink lead"><span class="fa-stack fa-lg" aria-hidden="true">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
              </span><span class="sr-only">Github</span>
            </a><a href="https://dieghernan.carto.com/" title="footerCarto" class="chulapa-footer-sociallink lead"><span class="fa-stack fa-lg" aria-hidden="true">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="far fa-dot-circle fa-stack-1x fa-inverse"></i>
              </span><span class="sr-only">Carto</span>
            </a><a href="https://rpubs.com/dieghernan" title="footerRPubs" class="chulapa-footer-sociallink lead"><span class="fa-stack fa-lg" aria-hidden="true">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fab fa-r-project fa-stack-1x fa-inverse"></i>
              </span><span class="sr-only">RPubs</span>
            </a></div><p class="mt-2 mb-3">&copy; 2022 dieghernan</p>
          <!-- Do not remove this in order to give  attributions --><p class="small"><b>Lux</b> skin by <a href="https://bootswatch.com/">Bootswatch</a></p><p class="small">Powered by <a href="https://dieghernan.github.io/chulapa"> <span class="chulapa">Chulapa</span> Jekyll Theme</a></p>
          <!-- End  attributions -->
       </div>
     </div>
 </div>
</footer>
<!-- Footer -->
<!-- JS, Popper.js, and jQuery -->
	<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
	<script src="https://dieghernan.github.io/assets/js/clipboardrouge.js"></script>
	<!-- start custom scripts to be placed at the bottom of the page -->
<!-- end custom bottom scripts -->
	</body>
