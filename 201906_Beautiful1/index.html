<!doctype html>
<html lang="en-US"><head>
   <meta charset="utf-8">
    <!-- Chulapa Jekyll Theme - master dev -->
    <!--  MIT License-->
    <!-- Docs: https://dieghernan.github.io/chulapa -->
    <!-- Repo: https://github.com/dieghernan/chulapa -->
    <!-- Page build 2022-03-03 15:25:19 +0100 -->
    <!--Google Structured Data-->
    <script type="application/ld+json">
        {
      "@context": "https://schema.org",
      "@type": "BlogPosting",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://dieghernan.github.io/201906_Beautiful1/"
      },
      "headline": "Beautiful Maps with R (I): Fishnets, Honeycombs and Pixels",
      "image": "https://dieghernan.github.io/assets/img/blog/20190602_imgpost-1.png",
      "datePublished": "2019-06-02T00:00:00+02:00",
      "dateModified": "2019-06-02T00:00:00+02:00",
      "author": {
        "@type": "Person",
        "name": "dieghernan"
      },
       "publisher": {
        "@type": "Organization",
        "name": "dieghernan",
        "logo": {
          "@type": "ImageObject",
          "url": "https://dieghernan.github.io/assets/img/site/banner.png"
        }
      }
    }
    </script>
        <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Blog",
        "item": "https://dieghernan.github.io/blog/"
      },
    {
        "@type": "ListItem",
        "position": 2,
        "name": "Beautiful Maps with R (I): Fishnets, Honeycombs and Pixels"
      }]
    }
    </script>
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "name": "Beautiful Maps with R (I): Fishnets, Honeycombs and Pixels",
    "description": "Awesome simplified maps with R - Sometimes you want to produce maps with special layouts. I specially like maps with modified geometries, e.g. simplifiying the original shapes to squares or dots. When doing a little search over the web I found the fantastic post Fishnets and Honeycomb: Square vs. Hexagonal Spatial Grids by Matt Strimas-Mackey that was a huge inspiration (by the way, don’t miss his blog, full of very interesting pieces of work).
"
    }
}
</script><script type="application/ld+json">
{
  "@context" : "https://schema.org",
  "@type" : "Person",
  "image": "https://dieghernan.github.io/assets/img/site/avatar.png",
  "homeLocation": {
    "@type": "Place",
    "name": "Madrid, Spain"
    },
  "description": "Publisher",
  "name" : "dieghernan",
  "url" : "https://dieghernan.github.io/"
  ,  "sameAs" : [
  "https://github.com/dieghernan/"
  ]
}
</script>
   <title>Beautiful Maps with R (I): Fishnets, Honeycombs and Pixels | One world</title>
  <link rel="canonical" href="https://dieghernan.github.io/201906_Beautiful1/">
    <!-- Atom feed -->
  <link href="https://dieghernan.github.io/atom.xml" type="application/atom+xml" rel="alternate" title="Atom feed One world" />
    <!-- RSS 2.0 feed -->
  <link href="https://dieghernan.github.io/rss.xml" type="application/rss+xml" rel="alternate" title="RSS 2.0 feed One world" />
    <!-- Meta tags -->
   <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
   <meta name="author" content="dieghernan" />
   <meta name="copyright" content="dieghernan" />
   <meta name="description" content="Awesome simplified maps with R - Sometimes you want to produce maps with special layouts. I specially like maps with modified geometries, e.g. simplifiying t..."/>
   <meta name="thumbnail" content="https://dieghernan.github.io/assets/img/blog/20190602_imgpost-1.png" />
   <meta name="robots" content="index, follow"><meta name="keywords" content="blog,chulapa,maps,r-language"/>
    <!-- OpenGraph -->
   <meta property="og:title" content="Beautiful Maps with R (I): Fishnets, Honeycombs and Pixels | One world" />
   <meta property="og:site_name" content="One world | Projects, maps and coding" />
   <meta property="og:url" content="https://dieghernan.github.io/201906_Beautiful1/" />
   <meta property="og:type" content="website" />
   <meta property="og:description" content="Awesome simplified maps with R - Sometimes you want to produce maps with special layouts. I specially like maps with..." />
   <meta property="og:locale" content="en-US" />
   <meta property="og:image" content="https://dieghernan.github.io/assets/img/blog/20190602_imgpost-1.png" />
    <!-- Twitter Cards -->
   <meta name="twitter:card" content="summary_large_image">
   <meta name="twitter:site" content="@dhernangomez" />
    	<!-- CSS -->
    <!-- Preconnect with Google Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">
    <!-- Fontawesome-->
    <!-- v5.13 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">
    <!-- Theme css (Bootstrap included) -->
  <link rel="stylesheet" href="https://dieghernan.github.io/assets/css/main.css" />
    <!-- Highlighter -->
  <link id="csshigh" rel="stylesheet" href="https://dieghernan.github.io/assets/css/highlighter.css" />
    <!-- Custom css -->
  <link rel="stylesheet" href="https://dieghernan.github.io/assets/css/custom.css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-FWXW2HLTVZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-FWXW2HLTVZ');
</script>
<!-- start custom head snippets -->
<!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="mask-icon" href="/assets/img/favicons/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="msapplication-TileColor" content="#2b5797">
<meta name="msapplication-TileImage" content="/assets/img/favicons/mstile-144x144.png">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#000000">
<!-- end custom head snippets --></head>
<body class="d-flex flex-column">
	<div class="navbar-chulapa-fab d-xl-none">
		<input type="checkbox" class="navbar-chulapa-fab-button d-none" id="navi-toggle">
		<label for="navi-toggle" class="navbar-toggler p-1 m-0 text-center d-flex">
			<span class="navbar-toggler-icon m-auto">&nbsp;</span>
		</label>
		<div class="navbar-chulapa-fab-background">&nbsp;</div>
		<nav class="navbar-chulapa-fab-nav">
			<ul class="navbar-nav text-center text-uppercase font-weight-light mt-0 mb-1 py-1">
				<li class="nav-item">
					<a class="nav-link px-3 navbar-brand mx-1 " href="https://dieghernan.github.io/"><img src="https://dieghernan.github.io/assets/img/favicons/android-chrome-72x72.png" width="30" height="30" class="d-inline-block align-top rounded-lg text-center mr-1" alt="NavbarLogo">Home</a>
				</li><li class="nav-item my-0 py-1">
					<a class="nav-link px-3 py-1" href="https://dieghernan.github.io/blog/">Blog</a>
				</li><li class="nav-item my-0 py-1">
					<a class="nav-link px-3 py-1" href="https://dieghernan.github.io/projects">Projects</a>
				</li><li class="nav-item dropdown my-0 py-1"><a class="nav-link dropdown-toggle px-3 py-1 " href="#" id="Archives" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Archives</a>
					<div class="dropdown-menu dropdown-menu-right text-center rounded-0 pr-4" aria-labelledby="Archives"><a class="dropdown-item nav-link d-block px-3 small " href="https://dieghernan.github.io/archive">By date </a><a class="dropdown-item nav-link d-block px-3 small " href="https://dieghernan.github.io/tags">By tags </a></div>
				</li><li class="nav-item my-0 py-1">
					<a class="nav-link px-3 py-1" href="https://dieghernan.github.io/gallery">Gallery</a>
				</li><li class="nav-item my-0 py-1">
					<a class="nav-link px-3 py-1" href="https://github.com/dieghernan/dieghernan.github.io"><i class="fab fa-github" aria-hidden="true"></i> Github repo</a>
				</li><li class="nav-item my-0 py-1">
					<a class="nav-link px-3 py-1 " href="https://dieghernan.github.io/search">Search</a>
				</li></ul>
		</nav>
	</div>
	<nav class="navbar navbar-expand sticky-top navbar-chulapa d-none d-xl-block ">
	<div class="container-fluid mx-md-2">
			<a class="navbar-brand text-uppercase font-weight-light" href="https://dieghernan.github.io/"><img src="https://dieghernan.github.io/assets/img/favicons/android-chrome-72x72.png" width="30" height="30" class="d-inline-block align-top rounded-lg mr-1" alt="NavbarLogo">Home</a><ul class="navbar-nav ml-auto"><li class="nav-item mx-2">
						<a class="nav-link text-uppercase font-weight-light " href="https://dieghernan.github.io/blog/">Blog</a>
					</li><li class="nav-item mx-2">
						<a class="nav-link text-uppercase font-weight-light " href="https://dieghernan.github.io/projects">Projects</a>
					</li><li class="nav-item mx-2 dropdown"><a class="nav-link text-uppercase font-weight-light dropdown-toggle " href="#" id="Archives2" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Archives</a>
						<div class="dropdown-menu dropdown-menu-right" aria-labelledby="Archives2"><a class="dropdown-item text-uppercase font-weight-light " href="https://dieghernan.github.io/archive">By date</a><a class="dropdown-item text-uppercase font-weight-light " href="https://dieghernan.github.io/tags">By tags</a></div>
					</li><li class="nav-item mx-2">
						<a class="nav-link text-uppercase font-weight-light " href="https://dieghernan.github.io/gallery">Gallery</a>
					</li><li class="nav-item mx-2">
						<a class="nav-link text-uppercase font-weight-light " href="https://github.com/dieghernan/dieghernan.github.io"><i class="fab fa-github" aria-hidden="true"></i> Github repo</a>
					</li><li class="nav-item mx-2">
						<a class="nav-link text-uppercase font-weight-light " href="https://dieghernan.github.io/search">
							<i class="fa fa-search" aria-hidden="true"></i><span class="sr-only">Search</span>
						</a>
					</li></ul></div>
</nav>	<header class="header-chulapa"><div class="container-fluid header-chulapa-img w-100" style="background-image: url('https://dieghernan.github.io/assets/img/blog/20190602_imgpost-1.png')">
     </div><div class="container-lg mt-2">
       <div class="row">
           <div class="col-lg-8 offset-lg-2">
           <h1>Beautiful Maps with <strong>R</strong> (I): Fishnets, Honeycombs and Pixels</h1><p class="lead chulapa-subtitle">Awesome simplified maps with R</p>
           <hr class="mb-0">
			</div>
		</div>
	</div>
</header>
	<main class="container-lg pb-3 flex-fill">
<div class="row my-1">
<div class="col-lg-6 offset-lg-2 col small">
 <nav aria-label="breadcrumb">
  <ol class="breadcrumb my-0 py-0 chulapa-bg-transparent pl-0" itemscope itemtype="https://schema.org/BreadcrumbList">
            <li class="breadcrumb-item" itemprop="itemListElement" itemscope
          itemtype="https://schema.org/ListItem"><a href="https://dieghernan.github.io/blog/" itemprop="item"><span itemprop="name">Blog</span></a>
         <meta itemprop="position" content="1" /></li>
      <li class="breadcrumb-item active" aria-current="page" itemprop="itemListElement" itemscope
          itemtype="https://schema.org/ListItem">
        <span itemprop="name">Beautiful Maps with <strong>R</strong> (I): Fishnets, Honeycombs and Pixels</span>
       <meta itemprop="position" content="2" />
     </li>
 </ol>
 </nav>
 <div class="chulapaDateSocial">
            <time datetime="2019-06-02T00:00:00+02:00">02 jun 2019</time>
        </div></div><div class="col-lg-2 col-3 text-right lead chulapaDateSocial">
            <a  href="https://twitter.com/intent/tweet?url=https://dieghernan.github.io/201906_Beautiful1/&text=Beautiful+Maps+with+R+%28I%29%3A+Fishnets%2C+Honeycombs+and+Pixels&via=dhernangomez&hashtags=rstats,rspatial,beautiful_maps,maps,sf" title="Share on Twitter"><i class="fab fa-twitter-square fa-lg" aria-hidden="true"></i></a>
            <a  class="d-none d-sm-inline" href="https://www.facebook.com/sharer.php?u=https://dieghernan.github.io/201906_Beautiful1/" title="Share on Facebook"><i class="fab fa-facebook-square fa-lg" aria-hidden="true"></i></a>
             <a  href="https://api.whatsapp.com/send?&text=Beautiful+Maps+with+R+%28I%29%3A+Fishnets%2C+Honeycombs+and+Pixels%20https://dieghernan.github.io/201906_Beautiful1/" title="Share on Whatsapp"><i class="fab fa-whatsapp-square fa-lg" aria-hidden="true"></i></a>
         <a  class="d-none d-sm-inline" href="https://www.linkedin.com/shareArticle?url=https://dieghernan.github.io/201906_Beautiful1/&title=Beautiful+Maps+with+R+%28I%29%3A+Fishnets%2C+Honeycombs+and+Pixels" title="Share on LinkedIn"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
         </div></div>
		<div class="row pt-2">
			<aside class="col-lg-2 mt-lg-3 small"><div class="row d-flex align-items-center mb-2"><img src="https://dieghernan.github.io/assets/img/site/avatar.png" alt="dieghernan" class="ml-3 mr-0 mx-lg-auto mb-lg-1 chulapa-avatar-size"><div class="col-9 col-lg-12 text-lg-center">
						dieghernan
					</div>
				</div>
				<div class="row mb-2 mb-lg-0">
					<div class="col text-lg-center"><address class="d-inline d-lg-block mr-2 mx-lg-auto mb-lg-2 small chulapa-links-hover-only">
						  <a class="pr-lg-0" href="https://www.google.com/maps/search/?api=1&query=Madrid%2C+Spain">
						    <i class="fas fa-map-marker-alt fa-lg mr-1" aria-hidden="true"></i>Madrid, Spain</a>
						</address><div class="d-inline my-1 mx-lg-0 chulapa-links-hover-only"><a class="mr-2 mx-lg-1" href="https://github.com/dieghernan/"><i class="fab fa-github fa-lg"></i></a></div></div>
				</div>
</aside>
			<article class="col-lg-8 mt-3">
			<p>Sometimes you want to produce maps with special layouts. I specially like maps with modified geometries, e.g. simplifiying the original shapes to squares or dots. When doing a little search over the web I found the fantastic post <a href="http://strimas.com/spatial/hexagonal-grids/">Fishnets and Honeycomb: Square vs. Hexagonal Spatial Grids</a> by <a href="http://strimas.com/about/">Matt Strimas-Mackey</a> that was a huge inspiration (by the way, don’t miss <a href="http://strimas.com/#posts">his blog</a>, full of very interesting pieces of work).</p>
<p>The only thing I was not completely comfortable with was that the post used the <a href="https://geocompr.robinlovelace.net/intro.html#the-history-of-r-spatial">old-fashioned</a> <code class="language-plaintext highlighter-rouge">sp</code> package instead of my personal fav, the <code class="language-plaintext highlighter-rouge">sf</code> package, (the post was published in 2016, note that author has also moved to the <code class="language-plaintext highlighter-rouge">sf</code> package since then). So I decided to explore further options with <code class="language-plaintext highlighter-rouge">sf</code>.</p>
<p>The approach is similar (using grids over a map and work with that) but using <a href="https://www.rdocumentation.org/packages/sf/versions/0.7-4/topics/st_make_grid"><code class="language-plaintext highlighter-rouge">st_make_grid</code></a>. I also expanded it by grouping the grids and also producing dots over the geometries. So basically I produced 5 variations of the map:</p>
<table>
<thead>
   <tr>
     <th>Type</th>
     <th style="text-align: center">Replacement</th>
     <th style="text-align: center">Grouped</th>
   </tr>
 </thead>
 <tbody>
   <tr>
     <td><strong>Fishnet</strong></td>
     <td style="text-align: center">Square</td>
     <td style="text-align: center">No</td>
   </tr>
   <tr>
     <td><strong>Puzzle</strong></td>
     <td style="text-align: center">Square</td>
     <td style="text-align: center">Yes</td>
   </tr>
   <tr>
     <td><strong>Honeycomb</strong></td>
     <td style="text-align: center">Hexagon</td>
     <td style="text-align: center">No</td>
   </tr>
   <tr>
     <td><strong>Hexbin</strong></td>
     <td style="text-align: center">Hexagon</td>
     <td style="text-align: center">Yes</td>
   </tr>
   <tr>
     <td><strong>Pixel</strong></td>
     <td style="text-align: center">Dot</td>
     <td style="text-align: center">No</td>
   </tr>
 </tbody>
</table>
<h2 id="required-r-packages">Required R packages</h2>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">sf</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">giscoR</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">RColorBrewer</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<h2 id="working-with-square-grids">Working with square grids</h2>
<p>Let’s use the <code class="language-plaintext highlighter-rouge">square</code> option of <code class="language-plaintext highlighter-rouge">st_make_grid</code> and play a bit with it.</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">GB</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ne_download</span><span class="p">(</span><span class="m">50</span><span class="p">,</span><span class="w">
  </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"map_subunits"</span><span class="p">,</span><span class="w">
  </span><span class="n">returnclass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"sf"</span><span class="p">,</span><span class="w">
  </span><span class="n">destdir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tempdir</span><span class="p">()</span><span class="w">
</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">subset</span><span class="p">(</span><span class="n">CONTINENT</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Europe"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">subset</span><span class="p">(</span><span class="n">ADM0_A3</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"GBR"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Projecting and cleaning</span><span class="w">
</span><span class="n">GB</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_transform</span><span class="p">(</span><span class="n">GB</span><span class="p">,</span><span class="w"> </span><span class="m">3857</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">NAME_EN</span><span class="p">,</span><span class="w"> </span><span class="n">ADM0_A3</span><span class="p">)</span><span class="w">
</span><span class="n">initial</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">GB</span><span class="w">
</span><span class="n">initial</span><span class="o">$</span><span class="n">index_target</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">nrow</span><span class="p">(</span><span class="n">initial</span><span class="p">)</span><span class="w">
</span><span class="n">target</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_geometry</span><span class="p">(</span><span class="n">initial</span><span class="p">)</span><span class="w">

</span><span class="c1"># Create my own color palette</span><span class="w">
</span><span class="n">mypal</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">colorRampPalette</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#F3F8F8"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#008080"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>
<p class="alert alert-danger p-3 mx-2 mb-3"><i class="fas fa-exclamation-triangle"></i> <strong>Warning:</strong> The <code class="language-plaintext highlighter-rouge">cellsize</code> should be established in the same unit that the projection (in this case is meters). Pay special attention on this, given that if the parameter is too small (meaning that the grid is too dense) <strong>R</strong> could crash easily.</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">grid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_make_grid</span><span class="p">(</span><span class="n">target</span><span class="p">,</span><span class="w">
  </span><span class="m">50</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">1000</span><span class="p">,</span><span class="w">
  </span><span class="c1"># Kms</span><span class="w">
  </span><span class="n">crs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">st_crs</span><span class="p">(</span><span class="n">initial</span><span class="p">),</span><span class="w">
  </span><span class="n">what</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"polygons"</span><span class="p">,</span><span class="w">
  </span><span class="n">square</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="c1"># To sf</span><span class="w">
</span><span class="n">grid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_sf</span><span class="p">(</span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">lengths</span><span class="p">(</span><span class="n">grid</span><span class="p">)),</span><span class="w"> </span><span class="n">grid</span><span class="p">)</span><span class="w"> </span><span class="c1"># Add index</span><span class="w">

</span><span class="c1"># We identify the grids that belongs to a entity by assessing the centroid</span><span class="w">
</span><span class="n">cent_grid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_centroid</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span><span class="w">
</span><span class="n">cent_merge</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_join</span><span class="p">(</span><span class="n">cent_grid</span><span class="p">,</span><span class="w"> </span><span class="n">initial</span><span class="p">[</span><span class="s2">"index_target"</span><span class="p">],</span><span class="w"> </span><span class="n">left</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">)</span><span class="w">
</span><span class="n">grid_new</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inner_join</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span><span class="w"> </span><span class="n">st_drop_geometry</span><span class="p">(</span><span class="n">cent_merge</span><span class="p">))</span><span class="w">

</span><span class="c1"># Fishnet</span><span class="w">
</span><span class="n">Fishgeom</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aggregate</span><span class="p">(</span><span class="n">grid_new</span><span class="p">,</span><span class="w">
  </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">grid_new</span><span class="o">$</span><span class="n">index_target</span><span class="p">),</span><span class="w">
  </span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">min</span><span class="p">,</span><span class="w">
  </span><span class="n">do_union</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="c1"># Lets add the df</span><span class="w">
</span><span class="n">Fishnet</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">left_join</span><span class="p">(</span><span class="w">
  </span><span class="n">Fishgeom</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">index_target</span><span class="p">),</span><span class="w">
  </span><span class="n">st_drop_geometry</span><span class="p">(</span><span class="n">initial</span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">index_target</span><span class="p">)</span><span class="w">

</span><span class="c1"># Now lets create the Puzzle</span><span class="w">
</span><span class="n">Puzzlegeom</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aggregate</span><span class="p">(</span><span class="n">st_buffer</span><span class="p">(</span><span class="n">grid_new</span><span class="p">,</span><span class="w"> </span><span class="m">0.5</span><span class="p">),</span><span class="w"> </span><span class="c1"># Avoid slivers</span><span class="w">
  </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">grid_new</span><span class="o">$</span><span class="n">index_target</span><span class="p">),</span><span class="w">
  </span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">min</span><span class="p">,</span><span class="w">
  </span><span class="n">do_union</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="w">
</span><span class="p">)</span><span class="w"> </span><span class="c1"># This changes!!!</span><span class="w">

</span><span class="n">Puzzle</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">left_join</span><span class="p">(</span><span class="w">
  </span><span class="n">Puzzlegeom</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">index_target</span><span class="p">),</span><span class="w">
  </span><span class="n">st_drop_geometry</span><span class="p">(</span><span class="n">initial</span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">index_target</span><span class="p">)</span><span class="w">

</span><span class="c1"># Plot</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">mar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">bg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">st_geometry</span><span class="p">(</span><span class="n">Fishnet</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mypal</span><span class="p">(</span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Fishnet"</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">st_geometry</span><span class="p">(</span><span class="n">Puzzle</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mypal</span><span class="p">(</span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Puzzle"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p><img src="../assets/img/blog/20190602_squares-1.png" alt="plot of chunk 20190602_squares" /></p>
<h2 id="going-hex">Going hex</h2>
<p>Extremely easy. We just need to change the <code class="language-plaintext highlighter-rouge">square</code> parameter of <code class="language-plaintext highlighter-rouge">st_make_grid</code> from <code class="language-plaintext highlighter-rouge">TRUE</code> to <code class="language-plaintext highlighter-rouge">FALSE</code></p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">grid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_make_grid</span><span class="p">(</span><span class="n">target</span><span class="p">,</span><span class="w">
  </span><span class="m">50</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">1000</span><span class="p">,</span><span class="w"> </span><span class="c1"># Kms</span><span class="w">
  </span><span class="n">crs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">st_crs</span><span class="p">(</span><span class="n">initial</span><span class="p">),</span><span class="w">
  </span><span class="n">what</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"polygons"</span><span class="p">,</span><span class="w">
  </span><span class="n">square</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="w"> </span><span class="c1"># This is the only piece that changes!!!</span><span class="w">
</span><span class="p">)</span><span class="w">
</span><span class="c1"># Make sf</span><span class="w">
</span><span class="n">grid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_sf</span><span class="p">(</span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">lengths</span><span class="p">(</span><span class="n">grid</span><span class="p">)),</span><span class="w"> </span><span class="n">grid</span><span class="p">)</span><span class="w"> </span><span class="c1"># Add index</span><span class="w">

</span><span class="c1"># We identify the grids that belongs to a entity by assessing the centroid</span><span class="w">
</span><span class="n">cent_grid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_centroid</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span><span class="w">
</span><span class="n">cent_merge</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_join</span><span class="p">(</span><span class="n">cent_grid</span><span class="p">,</span><span class="w"> </span><span class="n">initial</span><span class="p">[</span><span class="s2">"index_target"</span><span class="p">],</span><span class="w"> </span><span class="n">left</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">)</span><span class="w">
</span><span class="n">grid_new</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inner_join</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span><span class="w"> </span><span class="n">st_drop_geometry</span><span class="p">(</span><span class="n">cent_merge</span><span class="p">))</span><span class="w">

</span><span class="c1"># Honeycomb</span><span class="w">
</span><span class="n">Honeygeom</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aggregate</span><span class="p">(</span><span class="w">
  </span><span class="n">grid_new</span><span class="p">,</span><span class="w">
  </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">grid_new</span><span class="o">$</span><span class="n">index_target</span><span class="p">),</span><span class="w">
  </span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">min</span><span class="p">,</span><span class="w">
  </span><span class="n">do_union</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="c1"># Lets add the df</span><span class="w">
</span><span class="n">Honeycomb</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">left_join</span><span class="p">(</span><span class="w">
  </span><span class="n">Honeygeom</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">select</span><span class="p">(</span><span class="n">index_target</span><span class="p">),</span><span class="w">
  </span><span class="n">st_drop_geometry</span><span class="p">(</span><span class="n">initial</span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">index_target</span><span class="p">)</span><span class="w">

</span><span class="c1"># Now lets create the Hexbin</span><span class="w">

</span><span class="n">Hexbingeom</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aggregate</span><span class="p">(</span><span class="w">
  </span><span class="n">st_buffer</span><span class="p">(</span><span class="n">grid_new</span><span class="p">,</span><span class="w"> </span><span class="m">0.5</span><span class="p">),</span><span class="w"> </span><span class="c1"># Avoid slivers</span><span class="w">
  </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">grid_new</span><span class="o">$</span><span class="n">index_target</span><span class="p">),</span><span class="w">
  </span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">min</span><span class="p">,</span><span class="w">
  </span><span class="n">do_union</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="n">Hexbin</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">left_join</span><span class="p">(</span><span class="w">
  </span><span class="n">Hexbingeom</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">select</span><span class="p">(</span><span class="n">index_target</span><span class="p">),</span><span class="w">
  </span><span class="n">st_drop_geometry</span><span class="p">(</span><span class="n">initial</span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">index_target</span><span class="p">)</span><span class="w">

</span><span class="c1"># Plot</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">mar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">bg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">st_geometry</span><span class="p">(</span><span class="n">Honeycomb</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mypal</span><span class="p">(</span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Honeycomb"</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">st_geometry</span><span class="p">(</span><span class="n">Hexbin</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mypal</span><span class="p">(</span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Hexbin"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p><img src="../assets/img/blog/20190602_hex-1.png" alt="plot of chunk 20190602_hex" /></p>
<h2 id="pixel-it">Pixel it!</h2>
<p>Also quite easy, just a couple of tweaks more, always using <code class="language-plaintext highlighter-rouge">st_make_grid</code>.</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">grid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_make_grid</span><span class="p">(</span><span class="n">target</span><span class="p">,</span><span class="w">
  </span><span class="m">50</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">1000</span><span class="p">,</span><span class="w"> </span><span class="c1"># Kms</span><span class="w">
  </span><span class="n">crs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">st_crs</span><span class="p">(</span><span class="n">initial</span><span class="p">),</span><span class="w">
  </span><span class="n">what</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"centers"</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="c1"># Make sf</span><span class="w">
</span><span class="n">grid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_sf</span><span class="p">(</span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">lengths</span><span class="p">(</span><span class="n">grid</span><span class="p">)),</span><span class="w"> </span><span class="n">grid</span><span class="p">)</span><span class="w"> </span><span class="c1"># Add index</span><span class="w">

</span><span class="c1"># We identify the grids that belongs to a entity by assessing the centroid</span><span class="w">
</span><span class="n">cent_grid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_centroid</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span><span class="w">
</span><span class="n">cent_merge</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_join</span><span class="p">(</span><span class="n">cent_grid</span><span class="p">,</span><span class="w"> </span><span class="n">initial</span><span class="p">[</span><span class="s2">"index_target"</span><span class="p">],</span><span class="w"> </span><span class="n">left</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">)</span><span class="w">
</span><span class="n">grid_new</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_buffer</span><span class="p">(</span><span class="n">cent_merge</span><span class="p">,</span><span class="w"> </span><span class="m">50</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">1000</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="n">Pixelgeom</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aggregate</span><span class="p">(</span><span class="w">
  </span><span class="n">grid_new</span><span class="p">,</span><span class="w">
  </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">grid_new</span><span class="o">$</span><span class="n">index_target</span><span class="p">),</span><span class="w">
  </span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">min</span><span class="p">,</span><span class="w">
  </span><span class="n">do_union</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="w">
</span><span class="p">)</span><span class="w">
</span><span class="c1"># Lets add the df</span><span class="w">
</span><span class="n">Pixel</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">left_join</span><span class="p">(</span><span class="w">
  </span><span class="n">Pixelgeom</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">select</span><span class="p">(</span><span class="n">index_target</span><span class="p">),</span><span class="w">
  </span><span class="n">st_drop_geometry</span><span class="p">(</span><span class="n">initial</span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">index_target</span><span class="p">)</span><span class="w">

</span><span class="c1"># Plot</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">mar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">bg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">st_geometry</span><span class="p">(</span><span class="n">Pixel</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mypal</span><span class="p">(</span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Pixel"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p><img src="../assets/img/blog/20190602_pix-1.png" alt="plot of chunk 20190602_pix" /></p>
<h2 id="wrap-up">Wrap up</h2>
<p>So finally I wrapped all that in a function (see the code in <a href="https://github.com/dieghernan/dieghernan.github.io/tree/master/assets/functions">my repo</a>), that I named <code class="language-plaintext highlighter-rouge">stdh_gridpol</code>:</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">stdh_gridpol</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">sf</span><span class="p">,</span><span class="w">
                         </span><span class="n">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"fishnet"</span><span class="p">,</span><span class="w">
                         </span><span class="n">gridsize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.integer</span><span class="p">(</span><span class="w">
                           </span><span class="nf">min</span><span class="p">(</span><span class="w">
                             </span><span class="n">diff</span><span class="p">(</span><span class="n">st_bbox</span><span class="p">(</span><span class="n">sf</span><span class="p">)[</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">)]),</span><span class="w">
                             </span><span class="n">diff</span><span class="p">(</span><span class="n">st_bbox</span><span class="p">(</span><span class="n">sf</span><span class="p">)[</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">)])</span><span class="w">
                           </span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">40</span><span class="w">
                         </span><span class="p">),</span><span class="w">
                         </span><span class="n">sliver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">unique</span><span class="p">(</span><span class="n">st_geometry_type</span><span class="p">(</span><span class="n">sf</span><span class="p">))</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"POLYGON"</span><span class="p">,</span><span class="w"> </span><span class="s2">"MULTIPOLYGON"</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">stop</span><span class="p">(</span><span class="s2">"Input should be  MULTIPOLYGON or POLYGON"</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">to</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"fishnet"</span><span class="p">,</span><span class="w"> </span><span class="s2">"puzzle"</span><span class="p">,</span><span class="w"> </span><span class="s2">"honeycomb"</span><span class="p">,</span><span class="w"> </span><span class="s2">"hexbin"</span><span class="p">,</span><span class="w"> </span><span class="s2">"pixel"</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">stop</span><span class="p">(</span><span class="s2">"'to' should be 'fishnet','puzzle','honeycomb','hexbin' or 'pixel'"</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">

  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nf">class</span><span class="p">(</span><span class="n">sf</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"sf"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">initial</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sf</span><span class="w">
    </span><span class="n">initial</span><span class="o">$</span><span class="n">index_target</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">nrow</span><span class="p">(</span><span class="n">initial</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">initial</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_sf</span><span class="p">(</span><span class="n">index_target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">sf</span><span class="p">),</span><span class="w"> </span><span class="n">geom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sf</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">

  </span><span class="n">target</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_geometry</span><span class="p">(</span><span class="n">initial</span><span class="p">)</span><span class="w">

  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">to</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"fishnet"</span><span class="p">,</span><span class="w"> </span><span class="s2">"puzzle"</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">sq</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nb">T</span><span class="w">
  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">sq</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nb">F</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">to</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"pixel"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">grid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_make_grid</span><span class="p">(</span><span class="n">target</span><span class="p">,</span><span class="w">
      </span><span class="n">gridsize</span><span class="p">,</span><span class="w">
      </span><span class="n">crs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">st_crs</span><span class="p">(</span><span class="n">initial</span><span class="p">),</span><span class="w">
      </span><span class="n">what</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"centers"</span><span class="w">
    </span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">grid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_make_grid</span><span class="p">(</span><span class="w">
      </span><span class="n">target</span><span class="p">,</span><span class="w">
      </span><span class="n">gridsize</span><span class="p">,</span><span class="w">
      </span><span class="n">crs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">st_crs</span><span class="p">(</span><span class="n">initial</span><span class="p">),</span><span class="w">
      </span><span class="n">what</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"polygons"</span><span class="p">,</span><span class="w">
      </span><span class="n">square</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sq</span><span class="w">
    </span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="n">grid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_sf</span><span class="p">(</span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">lengths</span><span class="p">(</span><span class="n">grid</span><span class="p">)),</span><span class="w"> </span><span class="n">grid</span><span class="p">)</span><span class="w"> </span><span class="c1"># Add index</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">to</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"pixel"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">cent_merge</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_join</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span><span class="w"> </span><span class="n">initial</span><span class="p">[</span><span class="s2">"index_target"</span><span class="p">],</span><span class="w"> </span><span class="n">left</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">)</span><span class="w">
    </span><span class="n">grid_new</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_buffer</span><span class="p">(</span><span class="n">cent_merge</span><span class="p">,</span><span class="w"> </span><span class="n">gridsize</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">cent_grid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_centroid</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span><span class="w">
    </span><span class="n">cent_merge</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_join</span><span class="p">(</span><span class="n">cent_grid</span><span class="p">,</span><span class="w"> </span><span class="n">initial</span><span class="p">[</span><span class="s2">"index_target"</span><span class="p">],</span><span class="w"> </span><span class="n">left</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">)</span><span class="w">
    </span><span class="n">grid_new</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inner_join</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span><span class="w"> </span><span class="n">st_drop_geometry</span><span class="p">(</span><span class="n">cent_merge</span><span class="p">))</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">to</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"fishnet"</span><span class="p">,</span><span class="w"> </span><span class="s2">"honeycomb"</span><span class="p">,</span><span class="w"> </span><span class="s2">"pixel"</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">geom</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aggregate</span><span class="p">(</span><span class="w">
      </span><span class="n">grid_new</span><span class="p">,</span><span class="w">
      </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">grid_new</span><span class="o">$</span><span class="n">index_target</span><span class="p">),</span><span class="w">
      </span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">min</span><span class="p">,</span><span class="w">
      </span><span class="n">do_union</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="w">
    </span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">geom</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aggregate</span><span class="p">(</span><span class="w">
      </span><span class="n">st_buffer</span><span class="p">(</span><span class="n">grid_new</span><span class="p">,</span><span class="w"> </span><span class="n">sliver</span><span class="p">),</span><span class="w">
      </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">grid_new</span><span class="o">$</span><span class="n">index_target</span><span class="p">),</span><span class="w">
      </span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">min</span><span class="p">,</span><span class="w">
      </span><span class="n">do_union</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="w">
    </span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nf">class</span><span class="p">(</span><span class="n">initial</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"sf"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">fin</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">left_join</span><span class="p">(</span><span class="w">
      </span><span class="n">geom</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">index_target</span><span class="p">),</span><span class="w">
      </span><span class="n">st_drop_geometry</span><span class="p">(</span><span class="n">initial</span><span class="p">)</span><span class="w">
    </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
      </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">index_target</span><span class="p">)</span><span class="w">
    </span><span class="n">fin</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_cast</span><span class="p">(</span><span class="n">fin</span><span class="p">,</span><span class="w"> </span><span class="s2">"MULTIPOLYGON"</span><span class="p">)</span><span class="w">
    </span><span class="nf">return</span><span class="p">(</span><span class="n">fin</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">fin</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_cast</span><span class="p">(</span><span class="n">geom</span><span class="p">,</span><span class="w"> </span><span class="s2">"MULTIPOLYGON"</span><span class="p">)</span><span class="w">
    </span><span class="nf">return</span><span class="p">(</span><span class="n">st_geometry</span><span class="p">(</span><span class="n">fin</span><span class="p">))</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="c1"># End of the function-----</span><span class="w">

</span><span class="n">fish</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">stdh_gridpol</span><span class="p">(</span><span class="n">GB</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"fishnet"</span><span class="p">,</span><span class="w"> </span><span class="n">gridsize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">50</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">1000</span><span class="p">)</span><span class="w">
</span><span class="n">puzz</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">stdh_gridpol</span><span class="p">(</span><span class="n">GB</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"puzzle"</span><span class="p">,</span><span class="w"> </span><span class="n">gridsize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">50</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">1000</span><span class="p">)</span><span class="w">
</span><span class="n">hon</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">stdh_gridpol</span><span class="p">(</span><span class="n">GB</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"honeycomb"</span><span class="p">,</span><span class="w"> </span><span class="n">gridsize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">50</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">1000</span><span class="p">)</span><span class="w">
</span><span class="n">hex</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">stdh_gridpol</span><span class="p">(</span><span class="n">GB</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"hexbin"</span><span class="p">,</span><span class="w"> </span><span class="n">gridsize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">50</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">1000</span><span class="p">)</span><span class="w">
</span><span class="n">pix</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">stdh_gridpol</span><span class="p">(</span><span class="n">GB</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"pixel"</span><span class="p">,</span><span class="w"> </span><span class="n">gridsize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">50</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">1000</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p><img src="../assets/img/blog/20190602_functionex-1.png" alt="plot of chunk 20190602_functionex" /></p>
<p>And that’s it! The function <code class="language-plaintext highlighter-rouge">stdh_gridpol</code> has some alert mechanisms, as accepting only <code class="language-plaintext highlighter-rouge">POLYGON</code> or <code class="language-plaintext highlighter-rouge">MULTIPOLYGON</code>, and the default value of <code class="language-plaintext highlighter-rouge">gridsize</code> is computed in a way that the shortest dimension would have 40 cells.</p>
</article>
		</div>
	</main><nav aria-label="Navigation" class="container-lg chulapa-pagination  ">
 <ul class="col-lg-8 offset-lg-2 pagination chulapa-pagination-round px-0 ">
   <li class="page-item text-left mr-auto ">
      <a class="page-link border-0 px-4" href="https://dieghernan.github.io/201905_Leaflet_R_Jekyll/" tabindex="-1">
	  <i class="fa fa-chevron-left" aria-hidden="true"></i><span class="sr-only">Previous</span>
	  </a>
   </li>
   <li class="page-item text-right ml-auto ">
      <a class="page-link border-0 px-4" href="https://dieghernan.github.io/201906_Beautiful2/">
	  <i class="fa fa-chevron-right" aria-hidden="true"></i><span class="sr-only">Next</span></a>
   </li>
 </ul>
</nav>
<div class="container-lg my-1">
 <div class="row">
   <div class="col-lg-8 offset-lg-2 col">
      <i class="fas fa-tag mr-1 fa-xs" aria-hidden="true"></i>
      <a href="https://dieghernan.github.io/tags#rstats" class="badge chulapa-pill-bg-primary">rstats</a>
      <a href="https://dieghernan.github.io/tags#rspatial" class="badge chulapa-pill-bg-primary">rspatial</a>
      <a href="https://dieghernan.github.io/tags#beautiful_maps" class="badge chulapa-pill-bg-primary">beautiful_maps</a>
      <a href="https://dieghernan.github.io/tags#maps" class="badge chulapa-pill-bg-primary">maps</a>
      <a href="https://dieghernan.github.io/tags#sf" class="badge chulapa-pill-bg-primary">sf</a>
     </div>
   </div>
</div>
<!-- Footer -->
 <footer class="footer-chulapa text-center mt-0 pt-3">
   <div class="container">
     <div class="row">
       <div class="col-xl-10 offset-xl-1"><div role="navigation" class="d-flex flex-wrap justify-content-center"><a href="https://dieghernan.github.io/atom.xml" title="footerRSS" class="chulapa-footer-sociallink lead"><span class="fa-stack fa-lg" aria-hidden="true">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
              </span><span class="sr-only">RSS</span>
            </a><a href="https://stackoverflow.com/users/7877917/dieghernan" title="footerStack Overflow" class="chulapa-footer-sociallink lead"><span class="fa-stack fa-lg" aria-hidden="true">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fab fa-stack-overflow fa-stack-1x fa-inverse"></i>
              </span><span class="sr-only">Stack Overflow</span>
            </a><a href="https://commons.wikimedia.org/wiki/Special:ListFiles?limit=50&user=dieghernan84" title="footerWikiCommons" class="chulapa-footer-sociallink lead"><span class="fa-stack fa-lg" aria-hidden="true">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fab fa-wikipedia-w fa-stack-1x fa-inverse"></i>
              </span><span class="sr-only">WikiCommons</span>
            </a><a href="https://github.com/dieghernan/" title="footerGithub" class="chulapa-footer-sociallink lead"><span class="fa-stack fa-lg" aria-hidden="true">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
              </span><span class="sr-only">Github</span>
            </a><a href="https://dieghernan.carto.com/" title="footerCarto" class="chulapa-footer-sociallink lead"><span class="fa-stack fa-lg" aria-hidden="true">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="far fa-dot-circle fa-stack-1x fa-inverse"></i>
              </span><span class="sr-only">Carto</span>
            </a><a href="https://rpubs.com/dieghernan" title="footerRPubs" class="chulapa-footer-sociallink lead"><span class="fa-stack fa-lg" aria-hidden="true">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fab fa-r-project fa-stack-1x fa-inverse"></i>
              </span><span class="sr-only">RPubs</span>
            </a></div><p class="mt-2 mb-3">&copy; 2022 dieghernan</p>
          <!-- Do not remove this in order to give  attributions --><p class="small"><b>Lux</b> skin by <a href="https://bootswatch.com/">Bootswatch</a></p><p class="small">Powered by <a href="https://dieghernan.github.io/chulapa"> <span class="chulapa">Chulapa</span> Jekyll Theme</a></p>
          <!-- End  attributions -->
       </div>
     </div>
 </div>
</footer>
<!-- Footer -->
<!-- JS, Popper.js, and jQuery -->
	<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
	<script src="https://dieghernan.github.io/assets/js/clipboardrouge.js"></script>
	<!-- start custom scripts to be placed at the bottom of the page -->
<!-- end custom bottom scripts -->
	</body>
